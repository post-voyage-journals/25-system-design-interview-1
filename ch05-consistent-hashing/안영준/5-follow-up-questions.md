# 5장 안정 해시 설계 - 면접 꼬리 질문

### Q1. 가상 노드의 개수는 어떻게 결정하나요? 

**예상 답변:**
- **트레이드오프 고려:**
  - 가상 노드가 많을수록 → 더 균등한 분포, 하지만 메타데이터 관리 비용 증가
  - 적을수록 → 메모리 효율적, 하지만 불균등한 분포 가능성

- **실무적 기준:**
  - 서버 대수, 예상 트래픽, 메모리 제약 등을 고려
  - 100~200개는 경험적으로 균형이 좋은 수치
  - 통계적으로 표준편차가 충분히 작아지는 지점

- **동적 조정:**
  - 시스템 모니터링 결과에 따라 조정 가능
  - 부하 불균형 발생 시 가상 노드 수 증가 고려

### Q2. 서버가 장애로 다운되었을 때 안정 해시는 어떻게 동작하나요?
**예상 답변:**
- **자동 재할당:**
  - 다운된 서버가 담당하던 키들이 해시 링의 다음 서버로 자동 이동
  - 클라이언트는 동일한 해시 계산을 통해 새로운 서버를 찾아감

- **장애 영향 범위:**
  - 다운된 서버가 담당하던 키만 영향받음
  - 다른 서버들의 키는 영향받지 않음

- **실무 고려사항:**
  - 캐시 시스템: 캐시 미스 발생, 원본에서 데이터 재로딩
  - 데이터 저장소: 복제(replication) 필요 (안정 해시 자체는 복제 기능 없음)

**추가 질문:**
- 복제본(replica)을 안정 해시와 함께 사용하려면 어떻게 설계해야 할까요?

---

### Q3. 안정 해시를 사용하는 실제 시스템 사례를 아는 대로 말해보세요.
**예상 답변:**
- **Amazon DynamoDB:** 데이터 파티셔닝
- **Apache Cassandra:** 노드 간 데이터 분산
- **Memcached 클러스터:** 캐시 서버 분산
- **Akamai CDN:** 콘텐츠 배포
- **Discord:** 메시지 라우팅

각 시스템이 안정 해시를 선택한 이유:
- 수평적 확장성
- 노드 추가/제거 시 최소한의 데이터 이동
- 고가용성 유지

---

### Q4. "핫스팟(Hot Spot)" 문제란 무엇이고, 안정 해시로 완전히 해결할 수 있나요?
**예상 답변:**
- **핫스팟 문제:**
  - 특정 키에 대한 요청이 집중되는 현상
  - 특정 서버에 부하가 과도하게 집중

- **안정 해시의 한계:**
  - 안정 해시는 키를 균등하게 "분배"하지만, "특정 키의 인기도"는 해결 못함
  - 예: 유명 연예인의 트윗 → 해당 키가 할당된 서버에 부하 집중

- **추가 해결책:**
  - 인기 키에 대한 별도 캐싱 레이어
  - 핫 키 감지 및 복제
  - 로드 밸런서 레벨에서의 처리
  - 데이터 샤딩 전략 재설계

---

### Q5. 분산 캐시 시스템을 설계할 때 안정 해시를 어떻게 적용하시겠습니까?
**예상 답변 포함 요소:**
- 클라이언트 라이브러리에 안정 해시 로직 구현
- 서버 목록 관리 (설정 파일 or 서비스 디스커버리)
- 캐시 미스 시 원본 데이터 로딩 전략
- 서버 장애 감지 및 제거 메커니즘
- 서버 추가 시 점진적 트래픽 이동 (warm-up)
- 복제본 관리 (선택적)
- 모니터링 및 알림

---